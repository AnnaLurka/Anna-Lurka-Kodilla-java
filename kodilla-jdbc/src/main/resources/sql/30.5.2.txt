USE KODILLA_COURSE;
DROP EVENT UPDATE_STATS;

DELIMITER $$

CREATE EVENT UPDATE_STATS
	ON SCHEDULE EVERY 1 MINUTE
    DO
	BEGIN
        DECLARE BESTSELLERS_QTY INT;
        CALL UpdateBestsellers();
        SELECT SUM(BESTSELLERS_QUANTITY) FROM BESTSELLERS_COUNT
		    INTO BESTSELLERS_QTY;

        INSERT INTO STATS(STAT_DATE, STAT, VALUE)
			VALUES(CURDATE(), "BESTSELLERS", BESTSELLERS_QTY);

	END $$

DELIMITER ;